# 웹 취약점 분석 기능 연동 완료

## 개요

백엔드 API 문서(`WEB_VULNERABILITY_ANALYSIS_API.md`)에 따라 웹 취약점 분석 기능의 프론트엔드 연동을 완료했습니다.

## 구현된 파일들

### 1. 타입 정의
**파일**: `lib/types/vulnerability.types.ts`
- 백엔드 API 응답 형식에 맞는 TypeScript 타입 정의
- `Vulnerability`: 개별 취약점 정보
- `VulnerabilityAnalysisRequest`: 분석 요청
- `VulnerabilityAnalysisResponse`: 분석 응답
- 취약점 유형, 심각도, 해결 방법 상수 정의

### 2. API 서비스
**파일**: `lib/services/website.service.ts`
- `vulnerabilityService.startAnalysis()`: 백엔드 `/api/analysis/start` 호출
- `vulnerabilityService.validateUrl()`: URL 유효성 검증
- JWT 토큰 자동 포함 (api-client.ts의 인터셉터 활용)
- 에러 처리 및 사용자 친화적 메시지

### 3. 웹사이트 점검 페이지
**파일**: `components/hero-section-website.tsx`
- URL 입력 폼
- 백엔드 API 호출 및 로딩 상태 관리
- Toast 알림으로 사용자 피드백
- 분석 결과를 sessionStorage에 저장
- 결과 페이지로 자동 이동

### 4. 스캔 결과 페이지
**파일**: `components/scan-results-view.tsx`
- 백엔드 API 응답 형식에 맞춘 데이터 표시
- sessionStorage에서 최신 결과 불러오기
- 취약점 심각도별 통계
- 취약점 상세 정보 및 해결 방법
- JSON 리포트 다운로드 기능

### 5. 레이아웃 업데이트
**파일**: `app/client-layout.tsx`
- Sonner Toast 추가 (알림 UI)

## API 엔드포인트

### 분석 시작
```
POST http://localhost:8080/api/analysis/start
Authorization: Bearer {JWT_TOKEN}
Content-Type: application/json

{
  "url": "https://example.com"
}
```

### 응답 형식
```json
{
  "success": true,
  "url": "https://example.com",
  "vulnerability_count": 3,
  "vulnerabilities": [
    {
      "type": "XSS",
      "severity": "HIGH",
      "pattern": "<script>alert('xss')</script>",
      "details": "Detected XSS vulnerability in search parameter",
      "confidence": 0.95,
      "location": "https://example.com/search?q="
    }
  ]
}
```

## 사용 방법

### 1. 백엔드 서버 실행
```bash
# Spring Boot 백엔드 실행
cd backend
./mvnw spring-boot:run

# Flask AI 서버 실행
cd flask-server
python app.py
```

### 2. 프론트엔드 실행
```bash
cd frontend
npm run dev
```

### 3. 웹사이트 점검
1. `http://localhost:3000/website-inspection` 접속
2. 분석할 URL 입력 (예: `https://example.com`)
3. "웹사이트 검사 시작" 버튼 클릭
4. 분석 완료 후 결과 페이지 자동 이동

### 4. 결과 확인
- **통계 카드**: CRITICAL, HIGH, MEDIUM, LOW 취약점 개수
- **취약점 테이블**: 전체 취약점 목록
- **상세 정보**: 각 취약점 클릭 시 상세 내용 및 해결 방법 표시
- **리포트 다운로드**: JSON 형식으로 전체 결과 다운로드

## 주요 기능

### 1. 실시간 분석
- 백엔드 API 호출로 실시간 웹 취약점 분석
- Flask AI 서버와 연동하여 머신러닝 기반 탐지

### 2. 사용자 인증
- JWT 토큰 기반 인증 (자동으로 헤더에 포함)
- 로그인하지 않은 사용자는 로그인 페이지로 리다이렉트

### 3. 에러 처리
- 네트워크 에러, 서버 에러 등 사용자 친화적 메시지
- Toast 알림으로 즉각적인 피드백

### 4. 결과 저장
- sessionStorage에 최신 분석 결과 저장
- 페이지 새로고침 시에도 결과 유지 (세션 동안)

## 취약점 유형

백엔드 API에서 탐지 가능한 취약점:
- **XSS** (Cross-Site Scripting)
- **SQL_INJECTION** (SQL 인젝션)
- **CSRF** (Cross-Site Request Forgery)
- **COMMAND_INJECTION** (명령어 실행 취약점)
- **PATH_TRAVERSAL** (경로 조작 취약점)
- **XXE** (XML External Entity)
- **SSRF** (Server-Side Request Forgery)
- **OPEN_REDIRECT** (오픈 리다이렉트)
- **SSTI** (Server-Side Template Injection)
- **CSP_MISSING** (CSP 헤더 누락)
- **MIME_SNIFFING** (MIME 스니핑 취약점)

## 심각도 분류

- **CRITICAL** (빨간색): 즉시 조치 필요, 매우 위험
- **HIGH** (주황색): 높은 위험도, 빠른 조치 필요
- **MEDIUM** (노란색): 중간 위험도
- **LOW** (녹색): 낮은 위험도

## 테스트 방법

### 1. 로그인
```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "password123"
  }'
```

### 2. 분석 요청
```bash
curl -X POST http://localhost:8080/api/analysis/start \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  -d '{
    "url": "https://example.com"
  }'
```

## 환경 변수 설정

`.env.local` 파일에 백엔드 URL 설정:
```bash
NEXT_PUBLIC_API_URL=http://localhost:8080/api
```

기본값은 `http://localhost:8080/api`입니다.

## 향후 개선 사항

1. **실시간 진행률 표시**: WebSocket을 통한 분석 진행 상태 업데이트
2. **분석 히스토리**: 과거 분석 결과 조회 및 비교
3. **PDF 리포트**: JSON 외에 PDF 형식 리포트 생성
4. **취약점 필터링**: 심각도, 유형별 필터링 기능
5. **재분석 기능**: 동일 URL 재분석 버튼

## 문제 해결

### "Unauthorized" 에러
- JWT 토큰이 만료되었거나 유효하지 않음
- 로그아웃 후 다시 로그인

### "AI 서버 통신 중 오류"
- Flask AI 서버가 실행되지 않음
- `http://127.0.0.1:5001`에서 Flask 서버 실행 확인

### CORS 에러
- `application.yml`에서 CORS 설정 확인
- 허용된 도메인에 프론트엔드 URL 포함

## 참고 문서

- **백엔드 API 문서**: `WEB_VULNERABILITY_ANALYSIS_API.md`
- **API 통합 가이드**: `API_INTEGRATION_README.md`
- **백엔드 CORS 설정**: `BACKEND_CORS_SETUP.md`

## 업데이트 내역

### 2025-11-21
- ✅ 백엔드 API 연동 완료
- ✅ 타입 정의 및 서비스 구현
- ✅ UI 컴포넌트 업데이트
- ✅ Toast 알림 추가
- ✅ 에러 처리 개선
